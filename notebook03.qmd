[TOP](https://8-u8.github.io/MathematicalStatistics/)

# 数理統計学ノート03 多次元確率分布
1変量の分布は一旦すっ飛ばした(僕が担当じゃないので)。  
多次元の確率分布について記述する。

## 同時分布と条件付き分布
$X$と$Y$を2つの確率変数とおく。この2つの確率変数の組$(X, Y)$を確率変数ベクトルと呼び、
$(X, Y)$が同時に発生する事象を考える。  
たとえば10円玉のコイントスの実現値を$X$、100円玉のコイントスの実現値を$Y$として、  
両手で同時にコイントスをする事を考えるのも良い。このとき表が出たら1、裏が出たら0と定義すれば、
確率変数は実際に$\mathbb{R}^2$(これは二次元の実数の集合を意味する)に属する要素の上で定義される。

### 同時分布と周辺分布の理論
同時分布について、まず離散確率変数を考える。  
基本的には単変量の分布を考えることと同様に考えることができる。  
「同時」の名前は、$(X,Y)$に関する具体的な値が一緒に与えられることを意味する。  
このとき、同時確率は
$$
p(x, y) = P(X = x, Y = y)
$$
で与えられるし、累積分布関数は
$$
F(x, y) = P(X \leq x, Y \leq y)
$$
で定義できる。基本は1次元確率分布と同様に定義できる。  
他の本でも基本は同様であるか[[久保川]](https://amzn.asia/d/eRgNHzehttps://amzn.asia/d/eRgNHze)、最初から一般の$d$次元確率変数の分布について定義をして、
$d=1$や$d=2$のときを特別な場合として記述しているような書籍もある[[清水]](https://8-u8.github.io/MathematicalStatistics/notebook03.html)。

$X$の周辺分布は、同時に起こりうる$Y$の値すべてを考慮したときの確率で、  
以下のように表現される。

$$
F_X(x) = P(X \leq x, Y \leq \infty)=\sum_{x \in X}^x\sum_{y \in Y}^{\infty}p(x, y)
$$

### クロス表と同時分布

もっと気楽に考えるとクロス集計表は同時分布の離散表現に近い。  
行和/列和がそれぞれ同時分布である。これがわかるとまあまあ集計時の見通しが良くなると思うし、  
クロス集計表が同時分布であるという雰囲気を感じるだけで「なんでこの表で検定ができるんだ？」  
というところにふんわりとした直感が働くようになるとも思う。

### 同時分布と周辺分布の可視化
ChatGPTに「同時分布のようなグラフを描くRのコードを描いて！」ってお願いしてみる。  
出てきた結果の一部は見にくい書き方をしていたので、ちょっと勝手に添削をしています。  

```{r}
# define density mixture function
dens_mixture <- function(x, y, mu = 0, sigma = 1) {
    out <- dnorm(x, mean = mu, sd = sigma) * dnorm(y, mean = mu, sd = sigma)
    out
}
# code below was written by ChatGPT
# Create a grid of x and y values
x <- seq(-4, 4, length.out = 100)
y <- seq(-4, 4, length.out = 100)
z <- outer(x, y, dens_mixture)

# Create the 3D plot
persp(x, y, z,
    a = 30, phi = 30, expand = 0.5,
    col = "lightblue", ltheta = 120, shade = 0.3,
    xlab = "X", ylab = "Y", zlab = "probability"
)

```

周辺分布は、例えば以下。上と右にあるのが周辺分布。  
ChatGPTに丸投げしたらあんまりいい感じにならなかったので、割と自分で書き直した。

```{r}
# Load the necessary libraries
set.seed(523)
library(ggplot2)
library(ggExtra)

# define density mixture function
dens_mixture <- function(x, y, mu = 0, sigma = 1) {
    out <- dnorm(x, mean = mu, sd = sigma) * dnorm(y, mean = mu, sd = sigma)
    out
}
# Define the normal distribution parameters
mu <- 0
sigma <- 1

# Create a dataset with x and y values
x <- rnorm(1000, mu, sigma)
y <- rnorm(1000, mu, sigma)
df <- data.frame(x = x, y = y)
# Create the 2D plot with marginal distributions
p <- ggplot2::ggplot(df) +
    ggplot2::geom_density2d(aes(x = x, y = y), geom = "line") +
    ggplot2::geom_point(aes(x = x, y = y)) +
    ggplot2::scale_fill_gradient(low = "white", high = "blue")

ggExtra::ggMarginal(p, type = "density")


```



### 条件付き分布

条件付き分布は、$(X, Y)$のうち、どちらか一方が与えられたという状態で、  
もう一方が実現する確率を表現する。つまり「同時」ではないし、  
お互いが何らかの法則を持って連動している。

$X=x$が与えられたときの$Y$の条件付き確率は以下のように記述される。

$$
P(Y=y|X=x) = \frac{P(X=x, Y=y)}{P(X=x)} = \frac{P(X=x, Y=y)}{\sum_{y \in Y}p(x, y)}
$$

あるいは以下のほうが使いやすいかも

$$
P(X=x, Y=y) = P(Y=y|X=x)P(X=x)
$$

もっというと、ここからベイズの定理が出てくる

$$
P(Y=y|X=x) = \frac{P(X=x|Y=y)P(Y=y)}{P(X=x)}
$$


解釈すると、同時分布を周辺分布で割る、ということになる。  
2値変数の同時分布は、以下のクロス表で表現できる。  
いつも見るクロス表だと、表側(行)が主語、表頭(列)が述語になるので、  
「Y=0の場合は、X=0になる確率は」という解釈をすることもなくはないが、  
これがクロス表で妥当な解釈であると考えられる場合は、後述の独立性を  
仮定として受け入れられるとき。  

|    | X=0|X=1 |  Yの周辺分布  |
|----|----|----|----|
|Y=0 |$P(X=0,Y=0)$|$P(X=1,Y=0)$|$P(Y=0)$|
|Y=1 |$P(X=0,Y=1)$|$P(X=1,Y=1)$|$P(Y=1)$|
|Xの周辺分布  |$P(X=0)$|$P(X=1)$|$1$|

$X$と$Y$が互いに独立であるとは、お互いの条件付き確率がもう一方に依存しないこと。  
つまり、上記の掛け算の方の式から、$P(Y=y|X=x) = P(Y=y)$が保証されること。
$$
P(X=x, Y=y) = P(Y=y)P(X=x) 
$$

ここまでなんとなく離散でやってきたけど基本的には連続化するアプローチは  
そんなに不自然で理解の難しい内容ではない。微小な定数$\Delta x$を用いて、  
0に向けて極限をとることで表現がなされる。  
周辺分布は興味のない方を積分すれば得られるし、同時分布は重積分で得られる。  

連続値における条件付き密度関数は、測度論的には注意が必要らしいけど、  
一旦踏み込むのを辞める。

> この条件付き密度関数の定義は直観的には正しいものであるが、測度論的には実はより  
> 注意深い議論が必要である。それは連続分布について最初に述べたように$X$が連続な  
> 確率変数ならば任意の$x$について$X=x$という事象の確率は0であるから、条件付き密度関数が
> どのような意味で定義できるかが明らかではないからである。

### 条件付き独立
条件付き独立はよく因果推論、及び因果探索で議論される事が多い気がする。  
3つの確率変数$X$、$Y$、$Z$があり、$Z=z$が与えられたときに、$X$と$Y$が条件付き独立であるとは、
$$
f_{X,Y|Z=z}(X,Y) = f_{X|Z=z}(x)f_{Y|Z=z}(y)
$$

を満たすことをいう。

## ヤコビアンと畳み込み
多分人生で一番難しい


## 条件付き期待値
世界一難しい


## 主な分布

### 多項分布
わからん


### 多変量正規分布
やさしい

 